{"version":3,"file":"ImageLensRenderer.66ae8896.js","sources":["../../../hoppscotch-common/src/components/lenses/renderers/ImageLensRenderer.vue"],"sourcesContent":["<template>\n  <div class=\"flex flex-col flex-1\">\n    <div\n      class=\"sticky z-10 flex items-center justify-between flex-shrink-0 pl-4 overflow-x-auto border-b bg-primary border-dividerLight top-lowerSecondaryStickyFold\"\n    >\n      <label class=\"font-semibold truncate text-secondaryLight\">\n        {{ t(\"response.body\") }}\n      </label>\n      <div class=\"flex\">\n        <ButtonSecondary\n          v-if=\"response.body\"\n          v-tippy=\"{ theme: 'tooltip', allowHTML: true }\"\n          :title=\"`${t(\n            'action.download_file'\n          )} <kbd>${getSpecialKey()}</kbd><kbd>J</kbd>`\"\n          :icon=\"downloadIcon\"\n          @click=\"downloadResponse\"\n        />\n      </div>\n    </div>\n    <img\n      class=\"flex max-w-full border-b border-dividerLight\"\n      :src=\"imageSource\"\n      loading=\"lazy\"\n      :alt=\"imageSource\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useI18n } from \"@composables/i18n\"\nimport { defineActionHandler } from \"~/helpers/actions\"\nimport { getPlatformSpecialKey as getSpecialKey } from \"~/helpers/platformutils\"\nimport { computed, onMounted, ref, watch } from \"vue\"\nimport { HoppRESTResponse } from \"~/helpers/types/HoppRESTResponse\"\nimport { useDownloadResponse } from \"~/composables/lens-actions\"\nimport { flow, pipe } from \"fp-ts/function\"\nimport * as S from \"fp-ts/string\"\nimport * as RNEA from \"fp-ts/ReadonlyNonEmptyArray\"\nimport * as A from \"fp-ts/Array\"\nimport * as O from \"fp-ts/Option\"\nimport { objFieldMatches } from \"~/helpers/functional/object\"\n\nconst t = useI18n()\n\nconst props = defineProps<{\n  response: HoppRESTResponse & { type: \"success\" | \"fail\" }\n}>()\n\nconst imageSource = ref(\"\")\n\nconst responseType = computed(() =>\n  pipe(\n    props.response,\n    O.fromPredicate(objFieldMatches(\"type\", [\"fail\", \"success\"] as const)),\n    O.chain(\n      // Try getting content-type\n      flow(\n        (res) => res.headers,\n        A.findFirst((h) => h.key.toLowerCase() === \"content-type\"),\n        O.map(flow((h) => h.value, S.split(\";\"), RNEA.head, S.toLowerCase))\n      )\n    ),\n    O.getOrElse(() => \"text/plain\")\n  )\n)\n\nconst { downloadIcon, downloadResponse } = useDownloadResponse(\n  responseType.value,\n  computed(() => props.response.body)\n)\n\nwatch(props.response, () => {\n  imageSource.value = \"\"\n  const buf = props.response.body\n  const bytes = new Uint8Array(buf)\n  const blob = new Blob([bytes.buffer])\n\n  const reader = new FileReader()\n  reader.onload = ({ target }) => {\n    // target.result will always be string because we're using FileReader.readAsDataURL\n    imageSource.value = target!.result as string\n  }\n  reader.readAsDataURL(blob)\n})\n\nonMounted(() => {\n  imageSource.value = \"\"\n  const buf = props.response.body\n  const bytes = new Uint8Array(buf)\n  const blob = new Blob([bytes.buffer])\n\n  const reader = new FileReader()\n  reader.onload = ({ target }) => {\n    // target.result will always be string because we're using FileReader.readAsDataURL\n    imageSource.value = target!.result as string\n  }\n  reader.readAsDataURL(blob)\n})\n\ndefineActionHandler(\"response.file.download\", () => downloadResponse())\n</script>\n"],"names":["t","useI18n","imageSource","ref","responseType","computed","pipe","props","O.fromPredicate","objFieldMatches","O.chain","flow","res","A.findFirst","h","O.map","S.split","RNEA.head","S.toLowerCase","O.getOrElse","downloadIcon","downloadResponse","useDownloadResponse","watch","buf","bytes","blob","reader","target","onMounted","defineActionHandler"],"mappings":"0nCA2CAA,EAAAC,IAMAC,EAAAC,EAAA,EAAA,EAEAC,EAAAC,EAAqB,IAAAC,EACnBC,EAAA,SACQC,EAAAC,EAAA,OAAA,CAAA,OAAA,SAAA,CAAA,CAAA,EAC+DC,EACnEC,EAEAC,GAAAA,EAAA,QACeC,EAAAC,GAAAA,EAAA,IAAA,YAAA,IAAA,cAAA,EAC4CC,EAAAJ,EAAAG,GAAAA,EAAA,MAAAE,EAAA,GAAA,EAAAC,EAAAC,CAAA,CAAA,CACS,CACpE,EACFC,EAAA,IAAA,YAAA,CAC8B,CAChC,EAGF,CAAA,aAAAC,EAAA,iBAAAC,CAAA,EAAAC,EAA2ClB,EAAA,MAC5BC,EAAA,IAAAE,EAAA,SAAA,IAAA,CACqB,EAGpC,OAAAgB,EAAAhB,EAAA,SAAA,IAAA,CACEL,EAAA,MAAA,GACA,MAAAsB,EAAAjB,EAAA,SAAA,KACAkB,EAAA,IAAA,WAAAD,CAAA,EACAE,EAAA,IAAA,KAAA,CAAAD,EAAA,MAAA,CAAA,EAEAE,EAAA,IAAA,WACAA,EAAA,OAAA,CAAA,CAAA,OAAAC,KAAA,CAEE1B,EAAA,MAAA0B,EAAA,MAA4B,EAE9BD,EAAA,cAAAD,CAAA,CAAyB,CAAA,EAG3BG,EAAA,IAAA,CACE3B,EAAA,MAAA,GACA,MAAAsB,EAAAjB,EAAA,SAAA,KACAkB,EAAA,IAAA,WAAAD,CAAA,EACAE,EAAA,IAAA,KAAA,CAAAD,EAAA,MAAA,CAAA,EAEAE,EAAA,IAAA,WACAA,EAAA,OAAA,CAAA,CAAA,OAAAC,KAAA,CAEE1B,EAAA,MAAA0B,EAAA,MAA4B,EAE9BD,EAAA,cAAAD,CAAA,CAAyB,CAAA,EAG3BI,EAAA,yBAAA,IAAAT,EAAA,CAAA"}
{"version":3,"file":"import.f1934bde.js","sources":["../../../hoppscotch-common/src/helpers/functional/primtive.ts","../../../hoppscotch-common/src/pages/import.vue"],"sourcesContent":["export type JSPrimitive =\n  | \"undefined\"\n  | \"object\"\n  | \"boolean\"\n  | \"number\"\n  | \"bigint\"\n  | \"string\"\n  | \"symbol\"\n  | \"function\"\n\nexport type TypeFromPrimitive<P extends JSPrimitive | undefined> =\n  P extends \"undefined\"\n    ? undefined\n    : P extends \"object\"\n    ? object | null // typeof null === \"object\"\n    : P extends \"boolean\"\n    ? boolean\n    : P extends \"number\"\n    ? number\n    : P extends \"bigint\"\n    ? bigint\n    : P extends \"string\"\n    ? string\n    : P extends \"symbol\"\n    ? symbol\n    : P extends \"function\"\n    ? Function // eslint-disable-line @typescript-eslint/ban-types\n    : unknown\n\n// The ban-types silence is because in this case,\n// we can't get the Function type info to make a better guess\n\nexport const isOfType =\n  <T extends JSPrimitive>(type: T) =>\n  (value: unknown): value is T =>\n    // eslint-disable-next-line valid-typeof\n    typeof value === type\n","<template>\n  <div></div>\n</template>\n\n<script setup lang=\"ts\">\nimport axios from \"axios\"\nimport * as TO from \"fp-ts/TaskOption\"\nimport * as TE from \"fp-ts/TaskEither\"\nimport * as RA from \"fp-ts/ReadonlyArray\"\n\nimport { onMounted } from \"vue\"\nimport { useRoute, useRouter } from \"vue-router\"\nimport * as E from \"fp-ts/Either\"\nimport { pipe } from \"fp-ts/function\"\nimport { HoppRESTRequest, HoppCollection } from \"@hoppscotch/data\"\nimport { appendRESTCollections } from \"~/newstore/collections\"\nimport { useI18n } from \"@composables/i18n\"\nimport { useToast } from \"@composables/toast\"\nimport { URLImporters } from \"~/helpers/import-export/import/importers\"\nimport { IMPORTER_INVALID_FILE_FORMAT } from \"~/helpers/import-export/import\"\nimport { OPENAPI_DEREF_ERROR } from \"~/helpers/import-export/import/openapi\"\nimport { isOfType } from \"~/helpers/functional/primtive\"\nimport { TELeftType } from \"~/helpers/functional/taskEither\"\n\nconst route = useRoute()\nconst router = useRouter()\nconst toast = useToast()\nconst t = useI18n()\n\nconst IMPORTER_INVALID_TYPE = \"importer_invalid_type\" as const\nconst IMPORTER_INVALID_FETCH = \"importer_invalid_fetch\" as const\n\nconst importCollections = (url: unknown, type: unknown) =>\n  pipe(\n    TE.Do,\n    TE.bind(\"importer\", () =>\n      pipe(\n        URLImporters,\n        RA.findFirst(\n          (importer) =>\n            importer.applicableTo.includes(\"url-import\") && importer.id === type\n        ),\n        TE.fromOption(() => IMPORTER_INVALID_TYPE)\n      )\n    ),\n    TE.bindW(\"content\", () =>\n      pipe(\n        url,\n        TO.fromPredicate(isOfType(\"string\")),\n        TO.chain(fetchUrlData),\n        TE.fromTaskOption(() => IMPORTER_INVALID_FETCH)\n      )\n    ),\n    TE.chainW(({ importer, content }) =>\n      pipe(\n        content.data,\n        TO.fromPredicate(isOfType(\"string\")),\n        TE.fromTaskOption(() => IMPORTER_INVALID_FILE_FORMAT),\n        TE.chain((data) => importer.importer([data]))\n      )\n    )\n  )\n\ntype ImportCollectionsError = TELeftType<ReturnType<typeof importCollections>>\n\nonMounted(async () => {\n  const { query } = route\n\n  const url = query.url\n  const type = query.type\n\n  const result = await importCollections(url, type)()\n\n  pipe(result, E.fold(handleImportFailure, handleImportSuccess))\n\n  router.replace(\"/\")\n})\n\nconst IMPORT_ERROR_MAP: Record<ImportCollectionsError, string> = {\n  [IMPORTER_INVALID_TYPE]: \"import.import_from_url_invalid_type\",\n  [IMPORTER_INVALID_FETCH]: \"import.import_from_url_invalid_fetch\",\n  [IMPORTER_INVALID_FILE_FORMAT]: \"import.import_from_url_invalid_file_format\",\n  [OPENAPI_DEREF_ERROR]: \"import.import_from_url_invalid_file_format\",\n} as const\n\nconst handleImportFailure = (error: ImportCollectionsError) => {\n  toast.error(t(IMPORT_ERROR_MAP[error]).toString())\n}\n\nconst handleImportSuccess = (\n  collections: HoppCollection<HoppRESTRequest>[]\n) => {\n  appendRESTCollections(collections)\n  toast.success(t(\"import.import_from_url_success\").toString())\n}\n\nconst fetchUrlData = (url: string) =>\n  TO.tryCatch(() =>\n    axios.get(url, {\n      responseType: \"text\",\n      transitional: { forcedJSONParsing: false },\n    })\n  )\n</script>\n"],"names":["isOfType","type","value","route","useRoute","router","useRouter","toast","useToast","t","useI18n","IMPORTER_INVALID_TYPE","IMPORTER_INVALID_FETCH","importCollections","url","pipe","TE.Do","TE.bind","URLImporters","RA.findFirst","importer","TE.fromOption","TE.bindW","TO.fromPredicate","TO.chain","fetchUrlData","TE.fromTaskOption","TE.chainW","content","IMPORTER_INVALID_FILE_FORMAT","TE.chain","data","onMounted","query","result","E.fold","handleImportFailure","handleImportSuccess","IMPORT_ERROR_MAP","OPENAPI_DEREF_ERROR","error","collections","appendRESTCollections","TO.tryCatch","axios"],"mappings":"yYAgCO,MAAMA,EACaC,GACvBC,GAEC,OAAOA,IAAUD,gCCZrB,MAAAE,EAAAC,IACAC,EAAAC,IACAC,EAAAC,IACAC,EAAAC,IAEAC,EAAA,wBACAC,EAAA,yBAEAC,EAAA,CAAAC,EAAAb,IAAAc,EACEC,EACKC,EACA,WAAK,IAAAF,EACNG,EACEC,EACGC,GAAAA,EAAA,aAAA,SAAA,YAAA,GAAAA,EAAA,KAAAnB,CAEiE,EACpEoB,EAAA,IAAAV,CAAA,CACyC,CAC3C,EACFW,EACG,UAAM,IAAAP,EACPD,EACES,EAAAvB,EAAA,QAAA,CAAA,EACmCwB,EAAAC,CAAA,EACdC,EAAA,IAAAd,CAAA,CACyB,CAChD,EACFe,EACG,CAAA,CAAA,SAAAP,EAAA,QAAAQ,CAAA,IAAAb,EACDa,EAAA,KACUL,EAAAvB,EAAA,QAAA,CAAA,EAC2B0B,EAAA,IAAAG,CAAA,EACiBC,EAAAC,GAAAX,EAAA,SAAA,CAAAW,CAAA,CAAA,CAAA,CACR,CAC9C,CACF,EAKJC,EAAA,SAAA,CACE,KAAA,CAAA,MAAAC,CAAA,EAAA9B,EAEAW,EAAAmB,EAAA,IACAhC,EAAAgC,EAAA,KAEAC,EAAA,MAAArB,EAAAC,EAAAb,CAAA,EAAA,EAEAc,EAAAmB,EAAAC,EAAAC,EAAAC,CAAA,CAAA,EAEAhC,EAAA,QAAA,GAAA,CAAkB,CAAA,EAGpB,MAAAiC,EAAA,CAAiE,CAAA3B,GAAA,sCACtC,CAAAC,GAAA,uCACC,CAAAiB,GAAA,6CACM,CAAAU,GAAA,4CACT,EAGzBH,EAAAI,GAAA,CACEjC,EAAA,MAAAE,EAAA6B,EAAAE,EAAA,EAAA,SAAA,CAAA,CAAiD,EAGnDH,EAAAI,GAAA,CAGEC,EAAAD,CAAA,EACAlC,EAAA,QAAAE,EAAA,gCAAA,EAAA,SAAA,CAAA,CAA4D,EAG9DgB,EAAAX,GAAA6B,EACK,IAAAC,EAAA,IAAA9B,EAAA,CACc,aAAA,OACC,aAAA,CAAA,kBAAA,EAAA,CAC2B,CAAA,CAC1C"}